<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for pledge\BscPledgeOracle.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">pledge/</a> BscPledgeOracle.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">59.09% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>13/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">33.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>8/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">83.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>10/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">66.67% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>20/30</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
pragma solidity 0.6.12;
&nbsp;
// 导入多重签名客户端合约
import "../multiSignature/multiSignatureClient.sol";
// 导入 Chainlink 的 AggregatorV3 接口
import "@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol";
&nbsp;
/**
 * @title BscPledgeOracle 合约
 * @dev 用于获取和设置资产价格，支持通过 Chainlink 预言机获取价格
 */
contract BscPledgeOracle is multiSignatureClient {
    // 映射：资产 ID 到对应的 Chainlink 价格聚合器接口
    mapping(uint256 =&gt; AggregatorV3Interface) internal assetsMap;
    // 映射：资产 ID 到对应的资产精度
    mapping(uint256 =&gt; uint256) internal decimalsMap;
    // 映射：资产 ID 到对应的资产价格
    mapping(uint256 =&gt; uint256) internal priceMap;
    // 内部精度变量，默认值为 1
    uint256 internal decimals = 1;
&nbsp;
    /**
     * @dev 合约构造函数
     * @param multiSignature 多重签名合约地址
     */
    constructor(address multiSignature) multiSignatureClient(multiSignature) public {
//        //  bnb/USD
//        assetsMap[uint256(0x0000000000000000000000000000000000000000)] = AggregatorV3Interface(0x2514895c72f50D8bd4B4F9b1110F0D6bD2c97526);
//        // DAI/USD
//        assetsMap[uint256(0xf2bDB4ba16b7862A1bf0BE03CD5eE25147d7F096)] = AggregatorV3Interface(0xE4eE17114774713d2De0eC0f035d4F7665fc025D);
//        // BTC/USD
//        assetsMap[uint256(0xF592aa48875a5FDE73Ba64B527477849C73787ad)] = AggregatorV3Interface(0x5741306c21795FdCBb9b265Ea0255F499DFe515C);
//        // BUSD/USD
//        assetsMap[uint256(0xDc6dF65b2fA0322394a8af628Ad25Be7D7F413c2)] = AggregatorV3Interface(0x9331b55D9830EF609A2aBCfAc0FBCE050A52fdEa);
//
//
//        decimalsMap[uint256(0x0000000000000000000000000000000000000000)] = 18;
//        decimalsMap[uint256(0xf2bDB4ba16b7862A1bf0BE03CD5eE25147d7F096)] = 18;
//        decimalsMap[uint256(0xF592aa48875a5FDE73Ba64B527477849C73787ad)] = 18;
//        decimalsMap[uint256(0xDc6dF65b2fA0322394a8af628Ad25Be7D7F413c2)] = 18;
    }
&nbsp;
    /**
     * @notice 设置精度
     * @dev 更新资产的精度
     * @param newDecimals 用于替换旧精度的新精度值
     */
    function setDecimals(uint256 newDecimals) public <span class="missing-if-branch" title="else path not taken" >E</span>validCall{
        decimals = newDecimals;
    }
&nbsp;
    /**
     * @notice 批量设置资产价格
     * @dev 更新多个资产的价格
     * @param assets 资产 ID 数组
     * @param prices 对应的资产价格数组
     */
    function setPrices(uint256[] memory assets, uint256[] memory prices) external <span class="missing-if-branch" title="else path not taken" >E</span>validCall {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(assets.length == prices.length, "input arrays' length are not equal");
        uint256 len = assets.length;
        for (uint i = 0; i &lt; len; i++){
            priceMap[i] = prices[i]; 
            // priceMap[assets[i]] = prices[i];     ？？？
        }
    }
&nbsp;
    /**
     * @notice 批量获取资产价格
     * @dev 获取多个资产的价格
     * @param assets 需要获取价格的资产 ID 数组
     * @return uint256[] 资产价格数组（按 1e8 缩放），若未设置或合约暂停则返回 0
     */
    function getPrices(uint256[] memory assets) public view returns (uint256[] memory) {
        uint256 len = assets.length;
        uint256[] memory prices = new uint256[](len);
        for (uint i = 0; i &lt; len; i++){
            prices[i] = getUnderlyingPrice(assets[i]);
        }
        return prices;
    }
&nbsp;
    /**
     * @notice 获取单个资产的价格
     * @dev 获取指定资产的价格
     * @param asset 需要获取价格的资产地址
     * @return uint256 资产价格（按 1e8 缩放），若未设置或合约暂停则返回 0
     */
    function getPrice(address asset) public view returns (uint256) {
        return getUnderlyingPrice(uint256(asset));
    }
&nbsp;
    /**
     * @notice 根据资产 ID 获取价格
     * @dev 根据资产 ID 获取对应的价格
     * @param underlying 需要获取价格的资产 ID
     * @return uint256 资产价格（按 1e8 缩放），若未设置或合约暂停则返回 0
     */
    function getUnderlyingPrice(uint256 underlying) public view returns (uint256) {
        AggregatorV3Interface assetsPrice = assetsMap[underlying];
        <span class="missing-if-branch" title="if path not taken" >I</span>if (address(assetsPrice) != address(0)){
<span class="cstat-no" title="statement not covered" >            (, int price,,,) = assetsPrice.latestRoundData();</span>
<span class="cstat-no" title="statement not covered" >            uint256 tokenDecimals = decimalsMap[underlying];</span>
<span class="cstat-no" title="statement not covered" >            if (tokenDecimals &lt; 18){</span>
<span class="cstat-no" title="statement not covered" >                return uint256(price)/decimals*(10**(18-tokenDecimals));</span>
            }else <span class="cstat-no" title="statement not covered" >if (tokenDecimals &gt; 18){</span>
<span class="cstat-no" title="statement not covered" >                return uint256(price)/decimals/(10**(18-tokenDecimals));</span>
            }else{
<span class="cstat-no" title="statement not covered" >                return uint256(price)/decimals;</span>
            }
        }else {
            return priceMap[underlying];
        }
    }
&nbsp;
    /**
     * @notice 设置单个资产的价格
     * @dev 设置指定资产的价格
     * @param asset 需要设置价格的资产地址
     * @param price 资产的价格
     */
    function setPrice(address asset, uint256 price) public <span class="missing-if-branch" title="else path not taken" >E</span>validCall {
        priceMap[uint256(asset)] = price;
    }
&nbsp;
    /**
     * @notice 设置底层资产的价格
     * @dev 设置指定底层资产的价格
     * @param underlying 需要设置价格的底层资产 ID
     * @param price 底层资产的价格
     */
    function setUnderlyingPrice(uint256 underlying, uint256 price) public <span class="missing-if-branch" title="else path not taken" >E</span>validCall {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(underlying &gt; 0 , "underlying cannot be zero");
        priceMap[underlying] = price;
    }
&nbsp;
    /**
     * @notice 设置资产的价格聚合器
     * @dev 设置指定资产的 Chainlink 价格聚合器和精度
     * @param asset 需要设置聚合器的资产地址
     * @param aggergator 资产的价格聚合器地址
     * @param _decimals 资产的精度
     */
    function setAssetsAggregator(address asset, address aggergator, uint256 _decimals) public <span class="missing-if-branch" title="else path not taken" >E</span>validCall {
        assetsMap[uint256(asset)] = AggregatorV3Interface(aggergator);
        decimalsMap[uint256(asset)] = _decimals;
    }
&nbsp;
    /**
     * @notice 设置底层资产的价格聚合器
     * @dev 设置指定底层资产的 Chainlink 价格聚合器和精度
     * @param underlying 需要设置聚合器的底层资产 ID
     * @param aggergator 底层资产的价格聚合器地址
     * @param _decimals 底层资产的精度
     */
<span class="fstat-no" title="function not covered" >    function setUnderlyingAggregator(uint256 underlying, address aggergator, uint256 _decimals) public validCall {</span>
<span class="cstat-no" title="statement not covered" >        require(underlying &gt; 0 , "underlying cannot be zero")</span>;
        assetsMap[underlying] = AggregatorV3Interface(aggergator);
        decimalsMap[underlying] = _decimals;
    }
&nbsp;
    /**
     * @notice 根据资产地址获取资产的价格聚合器和精度
     * @dev 获取指定资产的 Chainlink 价格聚合器地址和精度
     * @param asset 需要获取聚合器的资产地址
     * @return address 资产的价格聚合器地址
     * @return uint256 资产的精度
     */
    function getAssetsAggregator(address asset) public view returns (address, uint256) {
        return (address(assetsMap[uint256(asset)]), decimalsMap[uint256(asset)]);
    }
&nbsp;
    /**
     * @notice 根据底层资产 ID 获取资产的价格聚合器和精度
     * @dev 获取指定底层资产的 Chainlink 价格聚合器地址和精度
     * @param underlying 需要获取聚合器的底层资产 ID
     * @return address 底层资产的价格聚合器地址
     * @return uint256 底层资产的精度
     */
<span class="fstat-no" title="function not covered" >    function getUnderlyingAggregator(uint256 underlying) public view returns (address, uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return (address(assetsMap[underlying]), decimalsMap[underlying]);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Sep 21 2025 17:26:45 GMT+0800 (中国标准时间)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
